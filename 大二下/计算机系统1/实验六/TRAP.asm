	.ORIG	X2000
	;被调用者保存
	ST	R0,SAVER0
	ST	R1,SAVER1;
	ST	R2,SAVER2
	ST	R3,SAVER3
	ST	R4,SAVER4
	ST	R5,SAVER5
	;初始化
	AND	R1,R1,#0
	ST	R1,LENGTH
	;读取键盘
LOOP0	LDI	R3,KBDR
	AND	R1,R1,#0
	ADD	R1,R1,#-1
	STI	R3,DDR
	STI	R1,DSR
	;判断是否为回车
	LD	R4,HUICHE
	ADD	R4,R3,R4
	BRz	NEXT
	;输入的值计入长度
	LEA	R1,SHUZU
	LD	R2,LENGTH
	ADD	R1,R1,R2
	STR	R3,R1,#0
	ADD	R2,R2,#1
	ST	R2,LENGTH
	AND	R2,R2,#0
	;输入过程回显
	STI	R2,KBSR
	LDI	R3,KBDR
	NOT	R3,R3
	ADD	R3,R3,#1
	LD	R1,NKBSR
	STI	R1,KBSR
	;轮询等待输入
LOOP3	LDI	R4,KBSR
	BRzp	LOOP3
	BRnzp	LOOP0
	;输入为回车时
NEXT	AND	R3,R3,#0
	ADD	R3,R3,#10
	AND	R1,R1,#0;
	ADD	R1,R1,#-1
	STI	R3,DDR
	STI	R1,DSR
	AND	R2,R2,#0
	ADD	R2,R2,#10
LOOP1	LD	R0,LENGTH
	LEA	R4,SHUZU
LOOP2	LDR	R3,R4,#0
	AND	R1,R1,#0;
	ADD	R1,R1,#-1
	STI	R3,DDR
	STI	R1,DSR
	ADD	R4,R4,#1
	ADD	R0,R0,#-1
	BRnp	LOOP2
	
	LD	R5,SPACE
	AND	R1,R1,#0
	AND	R1,R1,#-1
	STI	R5,DDR
	STI	R1,DSR
	;双重循环输出十次字符串
	ADD	R2,R2,#-1
	BRp	LOOP1
	AND	R1,R1,#0
	ADD	R1,R1,#-1
	STI	R1,KBSR
	LD	R1,NKBSR
	STI	R1,KBSR
	;调用者读取
	LD	R0,SAVER0
	LD	R1,SAVER1
	LD	R2,SAVER2
	LD	R3,SAVER3
	LD	R4,SAVER4
	LD	R5,SAVER5
OVER	RTI
	HALT
SPACE	.FILL	X000A
NKBSR	.FILL	X7FFF
HUICHE	.FILL	#-10
SHUZU	.BLKW	X50
DDR	.FILL	XFE06
DSR	.FILL	XFE04
KBDR	.FILL	XFE02
KBSR	.FILL	XFE00
SAVER0	.FILL	X0
SAVER1	.FILL	X0
SAVER2	.FILL	X0
SAVER3	.FILL	X0
SAVER4	.FILL	X0
SAVER5	.FILL	X0
LENGTH	.FILL	X0
	.END



